<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Admin | EBIKE</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; display: flex; height: 100vh; margin: 0; }
        
        /* Sidebar */
        aside { width: 250px; background: #111; color: white; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        aside h2 { color: #e65a00; margin-bottom: 20px; }
        aside button { background: none; border: none; color: #ddd; text-align: left; padding: 15px; cursor: pointer; font-size: 1rem; border-radius: 5px; }
        aside button:hover, aside button.active { background: #333; color: #e65a00; }

        /* ConteÃºdo */
        main { flex: 1; padding: 40px; overflow-y: auto; }
        .section { display: none; }
        .section.active { display: block; }
        h1 { margin-bottom: 30px; color: #333; }

        /* Tabelas e Cards */
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { color: #666; font-size: 0.9rem; }
        
        /* FormulÃ¡rio */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #666; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .btn-add { background: #e65a00; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-delete { color: red; cursor: pointer; font-weight: bold; border: none; background: none;}
    </style>
</head>
<body>

    <aside>
        <h2>EBIKE SYSTEM</h2>
        <button onclick="showSection('produtos')" class="active">ðŸ“¦ Gerenciar Produtos</button>
        <button onclick="showSection('pedidos')">ðŸ›’ Ver Pedidos</button>
    </aside>

    <main>
        <div id="produtos" class="section active">
            <h1>Estoque de Produtos</h1>
            
            <div class="card" style="background: #fff8f0; border: 1px solid #e65a00;">
                <h3>+ Novo Produto</h3>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="pName" placeholder="Nome do Produto">
                    <input type="number" id="pPrice" placeholder="PreÃ§o (ex: 4500.00)">
                    <input type="text" id="pDesc" placeholder="DescriÃ§Ã£o Curta">
                    <button class="btn-add" onclick="addProduto()">Salvar</button>
                </div>
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>PreÃ§o</th>
                            <th>DescriÃ§Ã£o</th>
                            <th>AÃ§Ã£o</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="pedidos" class="section">
            <h1>Pedidos Recebidos</h1>
            <div id="ordersList">
                </div>
        </div>
    </main>

    <script>
        const API_URL = 'http://localhost:3000/api';

        // Alternar abas
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('aside button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if(id === 'produtos') loadProdutos();
            if(id === 'pedidos') loadPedidos();
        }

        // --- FUNÃ‡Ã•ES DE PRODUTOS ---
        async function loadProdutos() {
            try {
                const res = await fetch(`${API_URL}/produtos`);
                const produtos = await res.json();
                const tbody = document.getElementById('productsTable');
                tbody.innerHTML = '';

                produtos.forEach(p => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${p.name}</td>
                            <td>R$ ${p.price.toLocaleString('pt-BR')}</td>
                            <td>${p.description}</td>
                            <td><button class="btn-delete" onclick="deleteProduto(${p.id})">Excluir</button></td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error("Erro ao carregar produtos:", error);
                alert("Erro ao conectar com o servidor. Ele estÃ¡ rodando?");
            }
        }

        async function addProduto() {
            const name = document.getElementById('pName').value;
            const price = parseFloat(document.getElementById('pPrice').value);
            const description = document.getElementById('pDesc').value;

            if(!name || !price) return alert('Preencha nome e preÃ§o!');

            await fetch(`${API_URL}/produtos`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, price, description, image: "Foto Nova" })
            });

            document.getElementById('pName').value = '';
            document.getElementById('pPrice').value = '';
            document.getElementById('pDesc').value = '';
            loadProdutos();
            alert('Produto Adicionado!');
        }

        async function deleteProduto(id) {
            if(confirm('Tem certeza que deseja excluir?')) {
                await fetch(`${API_URL}/produtos/${id}`, { method: 'DELETE' });
                loadProdutos();
            }
        }

        // --- FUNÃ‡Ã•ES DE PEDIDOS ---
        async function loadPedidos() {
            try {
                const res = await fetch(`${API_URL}/pedidos`);
                const pedidos = await res.json();
                const container = document.getElementById('ordersList');
                container.innerHTML = '';

                if(pedidos.length === 0) {
                    container.innerHTML = '<p>Nenhum pedido ainda.</p>';
                    return;
                }

                pedidos.forEach(p => {
                    let itensHtml = p.itens.map(i => `<li>${i.qty}x ${i.name}</li>`).join('');
                    container.innerHTML += `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <strong>Pedido #${p.id}</strong>
                                <span style="color:#666">${p.data}</span>
                            </div>
                            <ul style="margin-bottom:10px; padding-left:20px; color:#555;">${itensHtml}</ul>
                            <h3 style="color:#e65a00">Total: R$ ${p.total.toLocaleString('pt-BR')}</h3>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Erro ao carregar pedidos:", error);
            }
        }

        // Carrega produtos ao abrir
        loadProdutos();
    </script>
</body>
</html>